(function(){"use strict";var average=function(a){var r={mean:0,variance:0,deviation:0},t=a.length;for(var m,s=0,l=t;l--;s+=a[l]);for(m=r.mean=s/t,l=t,s=0;l--;s+=Math.pow(a[l]-m,2));r.deviation=Math.sqrt(r.variance=s/t);return r};var percentile=function(a,nth){a=a.sort();a.slice(0,a.length-Math.floor(nth/a.length));return average(a)};var timeUnitSize={second:1e3,minute:60*1e3,hour:60*60*1e3,day:24*60*60*1e3,month:30*24*60*60*1e3,quarter:3*30*24*60*60*1e3,year:365.2425*24*60*60*1e3};var tickFormatter=function(value,axis){var d=moment(value);var t=axis.tickSize[0]*timeUnitSize[axis.tickSize[1]];var span=axis.max-axis.min;var fmt;if(t<timeUnitSize.minute){fmt="LT"}else if(t<timeUnitSize.day){fmt="LT";if(span<2*timeUnitSize.day){fmt="LT"}else{fmt="MMM D LT"}}else if(t<timeUnitSize.month){fmt="MMM D"}else if(t<timeUnitSize.year){if(span<timeUnitSize.year){fmt="MMM"}else{fmt="MMM YY"}}else{fmt="YY"}return d.format(fmt)};function createBasicChart(el,url){$.ajax({url:url,type:"get",dataType:"json",data:{since:(new Date).getTime()/1e3-3600*24*7,resolution:"1h"},success:function(data){var inputs=[],avg,i,data_avg=[],p_95th,max_y=10;for(i=0;i<data.length;i++){inputs.push(data[i][1]);data[i][0]=data[i][0]*1e3;if(data[i][1]>max_y){max_y=data[i][1]}}p_95th=percentile(inputs);for(i=0;i<data.length;i++){data_avg.push([data[i][0],p_95th.mean])}var points=[{data:data,color:"rgba(86, 175, 232, 1)",shadowSize:0,lines:{lineWidth:2,show:true,fill:false}},{data:data_avg,color:"rgba(244, 63, 32, .4)",shadowSize:0,dashes:{lineWidth:2,show:true,fill:false}}];var options={xaxis:{mode:"time",tickFormatter:tickFormatter},yaxis:{min:0,max:max_y,tickFormatter:function(value){if(value>999999){return value/1e6+"mm"}if(value>999){return value/1e3+"k"}return value}},tooltip:true,tooltipOpts:{content:function(label,xval,yval,flotItem){return yval+" events<br>"+moment(xval).format("llll")},defaultTheme:false},grid:{show:true,hoverable:true,backgroundColor:"#ffffff",borderColor:"#DEE3E9",borderWidth:2,tickColor:"#DEE3E9"},hoverable:false,legend:{noColumns:5},lines:{show:false}};$.plot(el,points,options);$(window).resize(function(){$.plot(el,points,options)})}})}angular.module("sentry.charts",[]).directive("simpleChart",function(){return function(scope,element,attrs){createBasicChart(element,attrs.simpleChart)}})})();(function(){"use strict";angular.module("sentry.collection",[]).factory("Collection",function(){var defaults={sortFunc:null,limit:null};function Collection(collection,options){var i;Array.call(this);if(options===undefined){options={}}for(i in defaults){if(options[i]===undefined){options[i]=defaults[i]}}this.options=options;if(collection!==undefined){for(i=0;i<collection.length;i++){this.push(collection[i])}}return this}Collection.prototype=[];Collection.prototype.constructor=Collection;Collection.prototype.push=function push(item){if(this._updateExisting(item)){return}Array.prototype.push.apply(this,arguments);if(this.options.sortFunc){this.options.sortFunc(this)}if(this.options.limit&&this.length>this.options.limit){this.splice(this.options.limit,this.length-this.options.limit)}};Collection.prototype.unshift=function unshift(item){if(this._updateExisting(item)){return}Array.prototype.unshift.apply(this,arguments);if(this.options.sortFunc){this.options.sortFunc(this)}if(this.options.limit&&this.length>this.options.limit){this.splice(this.options.limit,this.length-this.options.limit)}};Collection.prototype.remove=function remove(item){for(var i=0;i<this.length;i++){if(this[i].id==item.id){this.splice(i,i+1);return}}};Collection.prototype._updateExisting=function _updateExisting(item){for(var i=0;i<this.length;i++){if(this[i].id==item.id){angular.extend(this[i],item);return true}}return false};return Collection})})();(function(){"use strict";var TEMPLATES={text:"input-text.html",select:"input-select.html"};var DEFAULT_TEMPLATE=TEMPLATES.text;function titleize(string){string=string.replace("_"," ");return string.charAt(0).toUpperCase()+string.slice(1)}angular.module("sentry.forms",[]).factory("Form",function(){var Form=function(fields,initial){var field,fieldName;this._data=angular.copy(initial||{});this._fields=fields;for(fieldName in fields){field=fields[fieldName];field.name=fieldName;field.value=this._data[fieldName];field.label=field.label||titleize(field.name);field.required=field.required||false;this[fieldName]=field}};Form.prototype.isUnchanged=function(){var data={},field,fieldName;for(fieldName in this._fields){field=this._fields[fieldName];if(field.value!=this._data[fieldName]){return false}}return true};Form.prototype.getData=function(){var data={},fieldName;for(fieldName in this._fields){data[fieldName]=this._fields[fieldName].value}return data};Form.prototype.setData=function(data){var fieldName;this._data=data;for(fieldName in this._fields){this._fields[fieldName].value=data[fieldName]||""}};return Form}).directive("formField",function(){return{restrict:"A",template:'<div ng-include="fieldTemplateUrl"></div>',scope:{formField:"="},link:function(scope,element,attrs,ctrl){var field=scope.formField;var templateName=TEMPLATES[field.type]||DEFAULT_TEMPLATE;scope.fieldTemplateUrl="templates/forms/"+templateName;scope.field=field}}})})();(function(){"use strict";angular.module("sentry.controllers.default",["classy"]).classy.controller({name:"DefaultCtrl"})})();(function(){"use strict";angular.module("sentry.controllers.deleteTeam",["classy"]).classy.controller({name:"DeleteTeamCtrl",inject:["$scope","$http","selectedTeam"],init:function(){var $scope=this.$scope;$scope.newOwner=null;this.$http.get("/api/0/teams/"+this.selectedTeam.id+"/projects/").success(function(data){$scope.projectList=data})},saveForm:function(){this.$http({method:"DELETE",url:"/api/0/teams/"+this.selectedTeam.id+"/"}).success(function(data){window.location.href="/"})}})})();(function(){"use strict";angular.module("sentry.controllers.groupDetails",["classy"]).classy.controller({name:"GroupDetailsCtrl",inject:["$scope","$http"],init:function(){this.$http.post("/api/0/groups/"+window.SentryConfig.selectedGroup.id+"/markseen/")}})})();(function(){"use strict";angular.module("sentry.controllers.manageTeamOwnership",["classy"]).classy.controller({name:"ManageTeamOwnershipCtrl",inject:["$scope","$http","selectedTeam"],init:function(){this.$scope.newOwner=null},isUnchanged:function(value){return value===null},saveForm:function(){this.$http.put("/api/0/teams/"+this.selectedTeam.id+"/",{owner:this.$scope.newOwner}).success(function(data){window.location.href="/"})}})})();(function(){"use strict";angular.module("sentry.controllers.manageTeamSettings",["classy"]).classy.controller({name:"ManageTeamSettingsCtrl",inject:["$scope","$http","selectedTeam"],init:function(){this.$scope.teamData={name:this.selectedTeam.name,slug:this.selectedTeam.slug}},isUnchanged:function(){for(var name in this.$scope.teamData){if(this.selectedTeam[name]!=this.$scope.teamData[name]){return false}}return true},saveForm:function(){this.$http.put("/api/0/teams/"+this.selectedTeam.id+"/",this.$scope.teamData).success(function(data){window.location.href="/account/teams/"+data.slug+"/settings"})}})})();(function(){"use strict";angular.module("sentry.controllers.projectStream",["classy"]).classy.controller({name:"ProjectStreamCtrl",inject:["Collection","selectedProject","$http","$scope","$window","$timeout"],init:function(){this.$scope.groupList=new this.Collection(this.$window.groupList);this.$timeout(this.pollForChanges,1e3);this.setChartDuration("1d")},setChartDuration:function(duration){this.$scope.chartDuration=duration;$.each(this.$scope.groupList,function(_,group){group.activeChartData=group.stats["24h"]})},pollForChanges:function(){var self=this;this.$http.get("/api/0/projects/"+this.selectedProject.id+"/groups/").success(function(data){for(var i=0;i<data.length;i++){self.$scope.groupList.unshift(data[i])}utils.sortArray(self.$scope.groupList,function(item){return[new Date(item.lastSeen).getTime()]}).splice(50)}).finally(function(){self.$timeout(self.pollForChanges,1e3)})}})})();(function(){"use strict";angular.module("sentry.controllers.teamDashboard",["classy"]).classy.controller({name:"TeamDashboardCtrl",init:function(){}})})();(function(){"use strict";var numberFormats=[[1e9,"b"],[1e6,"m"],[1e3,"k"]];var floatFormat=function(number,places){var multi=Math.pow(10,places);return parseInt(number*multi,10)/multi};var formatNumber=function(number){var b,x,y,o,p;number=parseInt(number,10);for(var i=0;b=numberFormats[i];i++){x=b[0];y=b[1];o=Math.floor(number/x);p=number%x;if(o>0){if(o/10>1||!p)return""+o+y;return""+floatFormat(number/x,1)+y}}return""+number};angular.module("sentry.directives.count",[]).directive("count",function(){return function(scope,element,attrs){var value=scope.$eval(attrs.count);if(value===undefined){element.text("")}else{element.text(formatNumber(value))}}})})();(function(){"use strict";angular.module("sentry.directives.timeSince",[]).directive("timeSince",["$timeout",function($timeout){return function timeSince(scope,element,attrs){var timeout_id;function update(value){if(!value||value===undefined){return""}element.text(moment.utc(value).fromNow())}function tick(){update(scope.$eval(attrs.timeSince));timeout_id=$timeout(tick,1e3)}scope.$watch(attrs.timeSince,update);element.bind("$destroy",function(){if(timeout_id){$timeout.cancel(timeout_id)}});tick()}}])})();var SentryApp=angular.module("app",["classy","sentry.charts","sentry.collection","sentry.forms","sentry.controllers.default","sentry.controllers.deleteTeam","sentry.controllers.groupDetails","sentry.controllers.manageTeamOwnership","sentry.controllers.manageTeamSettings","sentry.controllers.projectStream","sentry.controllers.teamDashboard","sentry.directives.count","sentry.directives.timeSince","ui.bootstrap"]).config(function($httpProvider,$interpolateProvider,$provide){"use strict";$interpolateProvider.startSymbol("<%");$interpolateProvider.endSymbol("%>");$httpProvider.defaults.xsrfCookieName="csrftoken";$httpProvider.defaults.xsrfHeaderName="X-CSRFToken";$provide.value("config",window.SentryConfig);$provide.value("selectedTeam",window.SentryConfig.selectedTeam);$provide.value("selectedProject",window.SentryConfig.selectedProject)});
//@ sourceMappingURL=app.min.map.js