{% extends "sentry/bases/organization.html" %}

{% load crispy_forms_tags %}
{% load i18n %}
{% load sentry_helpers %}

{% block title %}{% trans "Members" %} | {{ block.super }}{% endblock %}

{% block org_members_nav %}active{% endblock %}

{% block inner %}
  <h3>Members</h3>

  <p>{% blocktrans %}Members of your organization gain slightly elevated permissions over individual team members. For example, organization administrators can create new teams as well as manage all organization settings (including the list of admins).{% endblocktrans %}</p>

  <table class="table member-list">
    <thead>
      <tr>
        <th>Member</th>
        <th>Type</th>
        <th>Teams</th>
        <th class="squash">&nbsp;</th>
      </tr>
    </thead>
    <tbody>
      {% for member, team_list in member_list %}
        <tr>
          <td class="table-user-info">
            <img class="avatar" src="{% gravatar_url member.get_email size 72 %}">
            <h5>
              <a href="{% url 'sentry-organization-member-settings' organization.slug member.id %}">
                {{ member.get_display_name }}
              </a>
              {% if member.is_pending %}
              <small>&mdash; Invited</small>
              {% endif %}
            </h5>
            {{ member.get_email }}
          </td>
          <td>{{ member.get_type_display }}</td>
          <td>
            {% if member.has_global_access %}
              <span class="tip" title="Access to all teams">&infin;</span>
            {% elif team_list|length > 1 %}
              <span class="tip"
                    title="{% for team in team_list %}{{ team.name }}{% if not forloop.last %}, {% endif %}{% endfor %}">
                {{ team_list|length }} teams
              </span>
            {% else %}
              {{ team_list.0.name }}
            {% endif %}
          </td>
          <td class="align-right squash">
            {% if authorizing_access <= member.type %}
              {% if member.user != request.user or member_can_leave %}
              <a href="javascript:void(0)" class="btn btn-default btn-sm remove-member" data-member-id="{{ member.id }}"><span class="icon icon-trash"></span> &nbsp;Remove</a>
              {% endif %}
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}

{% block content_after %}
  <style>
  .member-list form {
    display: inline-block;
  }
  </style>
  <script>
  $('.remove-member').click(function(){
    if (!confirm('Are you sure you wish to remove this member?')) {
      return;
    }

    var $this = $(this);
    $.ajax({
      url: app.config.urlPrefix + '/api/0/organizations/' + app.config.organizationId + '/members/' + $this.data('member-id') + '/',
      method: 'DELETE',
      success: function() {
        $this.parents('tr').remove();
      },
      error: function() {
        alert('There was an error while trying to remove the team member.');
      }
    });
  });
  </script>
{% endblock %}
